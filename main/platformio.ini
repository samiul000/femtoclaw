; femtoclaw_mcu — PlatformIO project configuration
; Boards: ESP32, ESP32-S3, ESP32-C3, Raspberry Pi Pico W
; ─────────────────────────────────────────────────────────────────────────
; Usage:
;   pio run -e esp32c3        # build for ESP32-C3 Super Mini
;   pio run -e esp32          # build for ESP32
;   pio run -e picow          # build for Raspberry Pi Pico W
; ─────────────────────────────────────────────────────────────────────────
; NOTE: Change board name according to your board name before compiling.
;       Defaults works fine.
; ─────────────────────────────────────────────────────────────────────────

[platformio]
default_envs = esp32

[common]
build_flags =
    -Os
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections
    -DCORE_DEBUG_LEVEL=0

[common_esp32]
build_flags =
    ${common.build_flags}
    -w
    -DCONFIG_ESP_TASK_WDT_TIMEOUT_S=30
    -DBOARD_ESP32
    -DCONFIG_MBEDTLS_SSL_MAX_CONTENT_LEN=4096

; ── ESP32 generic devkit ──────────────────────────────────────────────────
[env:esp32]
platform       = espressif32
board          = esp32dev
framework      = arduino
monitor_speed  = 115200
upload_speed   = 921600
build_flags    = ${common_esp32.build_flags}

; ── ESP32-S3 ──────────────────────────────────────────────────────────────
[env:esp32s3]
platform       = espressif32
board          = esp32-s3-devkitc-1
framework      = arduino
monitor_speed  = 115200
upload_speed   = 921600
build_flags =
    ${common_esp32.build_flags}
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1

; ── ESP32-C3 (RISC-V) — Super Mini ───────────────────────────────────────
[env:esp32c3]
platform       = espressif32@6.9.0
board          = lolin_c3_mini
framework      = arduino
board_build.flash_mode = dio
board_build.f_flash   = 40000000L
monitor_speed  = 115200
upload_speed   = 460800
build_type     = release
build_unflags  = -std=gnu++11
build_flags =
    ${common_esp32.build_flags}
    -std=gnu++17
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
monitor_filters =
    direct
    colorize
monitor_dtr    = 0
monitor_rts    = 0

; ── Raspberry Pi Pico W ───────────────────────────────────────────────────
[env:picow]
platform             = https://github.com/maxgerhardt/platform-raspberrypi.git
board                = rpipicow
framework            = arduino
monitor_speed        = 115200
board_build.core     = earlephilhower
build_flags =
    ${common.build_flags}
    -DBOARD_PICO_W
    -DPICO_CYW43_ARCH_THREADSAFE_BACKGROUND=1
